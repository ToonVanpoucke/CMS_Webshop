<?php

use Drupal\node\NodeInterface;
use Drupal\commerce_product\Entity\Product;
use Drupal\commerce_product\Entity\ProductVariation;

function book_auto_product_node_insert(NodeInterface $node) {
  if ($node->getType() !== 'book') {
    return;
  }

  $variation = ProductVariation::create([
    'type' => 'default', // jouw variation type
    'sku' => 'book-' . $node->id(),
    'title' => $node->getTitle(), 
    'price' => [
      'number' => '20.00', 
      'currency_code' => 'EUR',
    ],
  ]);
  $variation->save();

  $product = Product::create([
    'type' => 'book',
    'title' => $node->getTitle(), 
    'variations' => [$variation],
  ]);
  $product->save();

  if ($node->hasField('field_product')) {
    $node->set('field_product', ['target_id' => $product->id()]);
    $node->save();
  }
}
